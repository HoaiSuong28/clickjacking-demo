<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§ª Test Anti-Clickjacking Protection</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 40px;
      font-size: 1.1em;
    }
    .test-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border-left: 5px solid #667eea;
    }
    .test-section h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.8em;
    }
    .test-section h3 {
      color: #555;
      margin: 20px 0 10px 0;
      font-size: 1.3em;
    }
    .iframe-container {
      margin: 20px 0;
      border: 3px dashed #667eea;
      border-radius: 10px;
      padding: 15px;
      background: white;
    }
    .iframe-container iframe {
      width: 100%;
      height: 400px;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    .status {
      padding: 15px 20px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 600;
      font-size: 1.1em;
    }
    .status.protected {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }
    .status.vulnerable {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }
    .status.testing {
      background: #fff3cd;
      color: #856404;
      border: 2px solid #ffeaa7;
    }
    .code-block {
      background: #2d3748;
      color: #f7fafc;
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      line-height: 1.6;
    }
    .code-block code {
      color: #81e6d9;
    }
    .button-group {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-success {
      background: #48bb78;
      color: white;
    }
    .btn-danger {
      background: #f56565;
      color: white;
    }
    .btn-info {
      background: #4299e1;
      color: white;
    }
    .steps {
      list-style: none;
      counter-reset: step-counter;
      padding: 0;
    }
    .steps li {
      counter-increment: step-counter;
      padding: 15px 15px 15px 60px;
      margin: 10px 0;
      background: white;
      border-radius: 10px;
      position: relative;
      border: 2px solid #e2e8f0;
    }
    .steps li::before {
      content: counter(step-counter);
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: #667eea;
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
    }
    .alert {
      padding: 15px 20px;
      border-radius: 10px;
      margin: 15px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .alert-info {
      background: #bee3f8;
      color: #2c5282;
      border-left: 5px solid #4299e1;
    }
    .alert-warning {
      background: #feebc8;
      color: #744210;
      border-left: 5px solid #ed8936;
    }
    .alert-success {
      background: #c6f6d5;
      color: #22543d;
      border-left: 5px solid #48bb78;
    }
    .header-example {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #48bb78;
    }
    .header-example strong {
      color: #667eea;
      display: block;
      margin-bottom: 5px;
    }
    .header-example code {
      color: #e53e3e;
      background: #fed7d7;
      padding: 2px 8px;
      border-radius: 4px;
    }
    #console-output {
      background: #1a202c;
      color: #68d391;
      padding: 20px;
      border-radius: 10px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      margin: 20px 0;
      font-size: 0.9em;
      line-height: 1.6;
    }
    .timestamp {
      color: #90cdf4;
    }
    .error {
      color: #fc8181;
    }
    .success {
      color: #68d391;
    }
    .warning {
      color: #f6ad55;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›¡ï¸ Test Anti-Clickjacking Protection</h1>
    <p class="subtitle">Kiá»ƒm tra xem server cÃ³ cháº·n clickjacking attack khÃ´ng</p>

    <!-- Test 1: Iframe Blocking -->
    <div class="test-section">
      <h2>ğŸ§ª Test 1: Iframe Blocking</h2>
      <p><strong>Má»¥c tiÃªu:</strong> Kiá»ƒm tra xem website cÃ³ thá»ƒ bá»‹ nhÃºng vÃ o iframe hay khÃ´ng</p>
      
      <div class="status testing">
        â³ Äang test... Xem káº¿t quáº£ bÃªn dÆ°á»›i
      </div>

      <h3>ğŸ¯ Test Case 1.1: NhÃºng Homepage</h3>
      <p>Náº¿u middleware hoáº¡t Ä‘á»™ng Ä‘Ãºng, iframe sáº½ <strong>KHÃ”NG hiá»ƒn thá»‹</strong> vÃ  browser sáº½ bÃ¡o lá»—i trong Console.</p>
      <div class="iframe-container">
        <iframe 
          id="test-iframe-1" 
          src="http://localhost:3000"
          title="Test Homepage"
        ></iframe>
      </div>
      <div id="result-1" class="status" style="display:none;"></div>

      <h3>ğŸ¯ Test Case 1.2: NhÃºng Products Page</h3>
      <div class="iframe-container">
        <iframe 
          id="test-iframe-2" 
          src="http://localhost:3000/products"
          title="Test Products"
        ></iframe>
      </div>
      <div id="result-2" class="status" style="display:none;"></div>

      <h3>ğŸ¯ Test Case 1.3: NhÃºng Checkout Page</h3>
      <div class="iframe-container">
        <iframe 
          id="test-iframe-3" 
          src="http://localhost:3000/checkout"
          title="Test Checkout"
        ></iframe>
      </div>
      <div id="result-3" class="status" style="display:none;"></div>

      <div class="alert alert-info">
        <span>â„¹ï¸</span>
        <div>
          <strong>Káº¿t quáº£ mong Ä‘á»£i:</strong><br>
          Táº¥t cáº£ iframe pháº£i hiá»ƒn thá»‹ lá»—i: <code>"Refused to display 'http://localhost:3000' in a frame because it set 'X-Frame-Options' to 'deny'."</code>
        </div>
      </div>
    </div>

    <!-- Test 2: Response Headers -->
    <div class="test-section">
      <h2>ğŸ” Test 2: Kiá»ƒm tra Response Headers</h2>
      <p><strong>Má»¥c tiÃªu:</strong> XÃ¡c nháº­n cÃ¡c security headers Ä‘Ã£ Ä‘Æ°á»£c set Ä‘Ãºng</p>

      <h3>ğŸ“‹ HÆ°á»›ng dáº«n kiá»ƒm tra:</h3>
      <ol class="steps">
        <li>Má»Ÿ DevTools (F12)</li>
        <li>VÃ o tab <strong>Network</strong></li>
        <li>Refresh trang (Ctrl+R)</li>
        <li>Click vÃ o request Ä‘áº§u tiÃªn (localhost)</li>
        <li>Xem <strong>Response Headers</strong></li>
      </ol>

      <h3>âœ… Headers cáº§n cÃ³:</h3>
      <div class="header-example">
        <strong>1. X-Frame-Options</strong>
        <code>X-Frame-Options: DENY</code>
        <p style="margin-top:5px; color:#555;">â†’ Cháº·n hoÃ n toÃ n iframe</p>
      </div>
      
      <div class="header-example">
        <strong>2. Content-Security-Policy</strong>
        <code>Content-Security-Policy: frame-ancestors 'none'</code>
        <p style="margin-top:5px; color:#555;">â†’ TiÃªu chuáº©n hiá»‡n Ä‘áº¡i thay tháº¿ X-Frame-Options</p>
      </div>
      
      <div class="header-example">
        <strong>3. X-Content-Type-Options</strong>
        <code>X-Content-Type-Options: nosniff</code>
        <p style="margin-top:5px; color:#555;">â†’ NgÄƒn MIME type sniffing</p>
      </div>
      
      <div class="header-example">
        <strong>4. X-XSS-Protection</strong>
        <code>X-XSS-Protection: 1; mode=block</code>
        <p style="margin-top:5px; color:#555;">â†’ KÃ­ch hoáº¡t XSS filter</p>
      </div>
      
      <div class="header-example">
        <strong>5. X-Anti-Clickjacking-Enabled (Debug)</strong>
        <code>X-Anti-Clickjacking-Enabled: true</code>
        <p style="margin-top:5px; color:#555;">â†’ XÃ¡c nháº­n middleware Ä‘ang hoáº¡t Ä‘á»™ng</p>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="testHeaders()">ğŸ” Test Headers Tá»± Ä‘á»™ng</button>
        <button class="btn btn-info" onclick="copyHeadersTest()">ğŸ“‹ Copy Test Script</button>
      </div>

      <div id="headers-result" style="margin-top:20px;"></div>
    </div>

    <!-- Test 3: Backend Logs -->
    <div class="test-section">
      <h2>ğŸ“Š Test 3: Kiá»ƒm tra Backend Logs</h2>
      <p><strong>Má»¥c tiÃªu:</strong> XÃ¡c nháº­n middleware cÃ³ log requests khÃ´ng</p>

      <div class="alert alert-info">
        <span>â„¹ï¸</span>
        <div>
          <strong>Xem logs trong terminal backend:</strong><br>
          Má»—i request sáº½ cÃ³ log: <code>[timestamp] ğŸ›¡ï¸ Anti-Clickjacking: GET /api/products</code>
        </div>
      </div>

      <h3>ğŸ“ Expected Output:</h3>
      <div class="code-block">
<code>[2024-11-17T10:30:45.123Z] ğŸ›¡ï¸ Anti-Clickjacking: GET /
  âœ… X-Frame-Options: DENY
  âœ… Content-Security-Policy: frame-ancestors 'none'
  âœ… X-Content-Type-Options: nosniff

[2024-11-17T10:30:46.456Z] ğŸ›¡ï¸ Anti-Clickjacking: GET /api/products
  âœ… X-Frame-Options: DENY
  âœ… Content-Security-Policy: frame-ancestors 'none'
  âœ… X-Content-Type-Options: nosniff</code>
      </div>

      <h3>ğŸ® Live Console Output:</h3>
      <div id="console-output">
        <div class="timestamp">[Äá»£i requests...]</div>
      </div>

      <div class="button-group">
        <button class="btn btn-success" onclick="simulateRequests()">ğŸš€ Simulate Requests</button>
        <button class="btn btn-danger" onclick="clearConsole()">ğŸ—‘ï¸ Clear Console</button>
      </div>
    </div>

    <!-- Test 4: Attack Simulation -->
    <div class="test-section">
      <h2>ğŸ¯ Test 4: MÃ´ phá»ng Clickjacking Attack</h2>
      <p><strong>Má»¥c tiÃªu:</strong> Demo ká»‹ch báº£n táº¥n cÃ´ng thá»±c táº¿ vÃ  cÃ¡ch middleware cháº·n</p>

      <h3>ğŸ“– Ká»‹ch báº£n:</h3>
      <ol class="steps">
        <li>Hacker táº¡o trang web giáº£ (fake-bank.com)</li>
        <li>NhÃºng website tháº­t (lillyshoes.com) vÃ o iframe áº©n</li>
        <li>Äáº·t nÃºt giáº£ "Nháº­n 500K" Ä‘Ãºng vá»‹ trÃ­ nÃºt "Thanh toÃ¡n" tháº­t</li>
        <li>User click â†’ Thá»±c ra Ä‘ang click vÃ o iframe (chuyá»ƒn tiá»n cho hacker)</li>
      </ol>

      <div class="alert alert-warning">
        <span>âš ï¸</span>
        <div>
          <strong>KHÃ”NG cÃ³ middleware:</strong> Attack thÃ nh cÃ´ng, user bá»‹ lá»«a<br>
          <strong>CÃ“ middleware:</strong> Browser cháº·n iframe, attack tháº¥t báº¡i âœ…
        </div>
      </div>

      <h3>ğŸ§ª Demo Attack:</h3>
      <div class="button-group">
        <a href="http://localhost:3000/infected-page" target="_blank" class="btn btn-danger">
          ğŸš¨ Má»Ÿ Trang Bá»‹ Nhiá»…m (InfectedPage)
        </a>
        <button class="btn btn-primary" onclick="explainAttack()">ğŸ“– Giáº£i thÃ­ch Attack</button>
      </div>

      <div id="attack-explanation" style="display:none; margin-top:20px;">
        <div class="alert alert-success">
          <span>âœ…</span>
          <div>
            <strong>Vá»›i Anti-Clickjacking Middleware:</strong><br>
            â€¢ Browser nháº­n header X-Frame-Options: DENY<br>
            â€¢ Tá»« chá»‘i load iframe tá»« domain khÃ¡c<br>
            â€¢ Hiá»ƒn thá»‹ lá»—i trong Console<br>
            â€¢ User an toÃ n, khÃ´ng bá»‹ lá»«a âœ…
          </div>
        </div>
      </div>
    </div>

    <!-- Test 5: Manual Testing -->
    <div class="test-section">
      <h2>ğŸ› ï¸ Test 5: Manual Testing vá»›i cURL</h2>
      <p><strong>Má»¥c tiÃªu:</strong> Test tá»« command line Ä‘á»ƒ xem raw headers</p>

      <h3>ğŸ“ Test Commands:</h3>
      <div class="code-block">
<code># Test Homepage
curl -I http://localhost:3000

# Test API Endpoint
curl -I http://localhost:5000/api/products

# Test vá»›i verbose output
curl -v http://localhost:3000 2>&1 | grep -i "frame"</code>
      </div>

      <h3>âœ… Expected Output:</h3>
      <div class="code-block">
<code>HTTP/1.1 200 OK
X-Frame-Options: DENY
Content-Security-Policy: frame-ancestors 'none'
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Anti-Clickjacking-Enabled: true
...</code>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="copyCurlCommand()">ğŸ“‹ Copy cURL Command</button>
      </div>
    </div>

    <!-- Summary -->
    <div class="test-section">
      <h2>ğŸ“Š Test Summary</h2>
      
      <div id="test-summary">
        <h3>âœ… Checklist:</h3>
        <ul style="list-style:none; padding:0;">
          <li style="padding:10px; margin:5px 0; background:white; border-radius:5px;">
            <input type="checkbox" id="check1"> 
            <label for="check1"> Iframe blocking hoáº¡t Ä‘á»™ng (Test 1)</label>
          </li>
          <li style="padding:10px; margin:5px 0; background:white; border-radius:5px;">
            <input type="checkbox" id="check2"> 
            <label for="check2"> Response headers Ä‘áº§y Ä‘á»§ (Test 2)</label>
          </li>
          <li style="padding:10px; margin:5px 0; background:white; border-radius:5px;">
            <input type="checkbox" id="check3"> 
            <label for="check3"> Backend logs Ä‘Ãºng (Test 3)</label>
          </li>
          <li style="padding:10px; margin:5px 0; background:white; border-radius:5px;">
            <input type="checkbox" id="check4"> 
            <label for="check4"> Attack simulation failed (Test 4)</label>
          </li>
          <li style="padding:10px; margin:5px 0; background:white; border-radius:5px;">
            <input type="checkbox" id="check5"> 
            <label for="check5"> cURL test passed (Test 5)</label>
          </li>
        </ul>
      </div>

      <div class="alert alert-success" style="margin-top:20px;">
        <span>ğŸ‰</span>
        <div>
          <strong>Náº¿u táº¥t cáº£ tests pass:</strong><br>
          Anti-Clickjacking middleware Ä‘Ã£ hoáº¡t Ä‘á»™ng Ä‘Ãºng! Website cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c báº£o vá»‡ khá»i clickjacking attacks. âœ…
        </div>
      </div>
    </div>

  </div>

  <script>
    // Test iframe loading
    const iframes = document.querySelectorAll('iframe');
    iframes.forEach((iframe, index) => {
      iframe.addEventListener('load', () => {
        const resultDiv = document.getElementById(`result-${index + 1}`);
        try {
          // Try to access iframe content (will fail if CSP/X-Frame-Options block it)
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          if (iframeDoc) {
            resultDiv.className = 'status vulnerable';
            resultDiv.innerHTML = 'âŒ <strong>VULNERABLE!</strong> Iframe loaded successfully. Middleware NOT working!';
            resultDiv.style.display = 'block';
          }
        } catch (e) {
          resultDiv.className = 'status protected';
          resultDiv.innerHTML = 'âœ… <strong>PROTECTED!</strong> Iframe blocked by browser. Middleware working correctly!';
          resultDiv.style.display = 'block';
        }
      });

      iframe.addEventListener('error', () => {
        const resultDiv = document.getElementById(`result-${index + 1}`);
        resultDiv.className = 'status protected';
        resultDiv.innerHTML = 'âœ… <strong>PROTECTED!</strong> Iframe failed to load. Middleware working!';
        resultDiv.style.display = 'block';
      });
    });

    // Test headers automatically
    async function testHeaders() {
      const resultDiv = document.getElementById('headers-result');
      resultDiv.innerHTML = '<div class="status testing">â³ Testing headers...</div>';

      try {
        const response = await fetch('http://localhost:3000', { method: 'HEAD' });
        const headers = {};
        for (let [key, value] of response.headers.entries()) {
          headers[key] = value;
        }

        let html = '<h3>ğŸ“‹ Response Headers:</h3>';
        const requiredHeaders = [
          'x-frame-options',
          'content-security-policy',
          'x-content-type-options',
          'x-xss-protection',
          'x-anti-clickjacking-enabled'
        ];

        requiredHeaders.forEach(header => {
          const value = headers[header];
          if (value) {
            html += `<div class="header-example">
              <strong>âœ… ${header}</strong>
              <code>${value}</code>
            </div>`;
          } else {
            html += `<div class="alert alert-warning">
              <span>âš ï¸</span>
              <div><strong>Missing:</strong> ${header}</div>
            </div>`;
          }
        });

        resultDiv.innerHTML = html;
      } catch (error) {
        resultDiv.innerHTML = `<div class="alert alert-warning">
          <span>âš ï¸</span>
          <div><strong>Error:</strong> ${error.message}<br>
          <small>CÃ³ thá»ƒ do CORS. Xem manual test vá»›i DevTools thay vÃ¬.</small></div>
        </div>`;
      }
    }

    // Copy headers test script
    function copyHeadersTest() {
      const script = `// Paste this in DevTools Console
fetch('http://localhost:3000', { method: 'HEAD' })
  .then(res => {
    console.log('Headers:');
    for (let [key, value] of res.headers.entries()) {
      console.log(\`\${key}: \${value}\`);
    }
  });`;
      
      navigator.clipboard.writeText(script).then(() => {
        alert('âœ… Script copied! Paste vÃ o DevTools Console.');
      });
    }

    // Simulate requests
    let requestCount = 0;
    async function simulateRequests() {
      const output = document.getElementById('console-output');
      const endpoints = [
        '/',
        '/api/products',
        '/api/cart',
        '/api/user/coupons',
        '/checkout'
      ];

      for (let endpoint of endpoints) {
        requestCount++;
        const timestamp = new Date().toISOString();
        const log = `<div class="timestamp">[${timestamp}]</div>
          <div class="success">ğŸ›¡ï¸ Anti-Clickjacking: GET ${endpoint}</div>
          <div style="margin-left:20px; color:#90cdf4;">
            âœ… X-Frame-Options: DENY<br>
            âœ… Content-Security-Policy: frame-ancestors 'none'<br>
            âœ… X-Content-Type-Options: nosniff
          </div><br>`;
        
        output.innerHTML += log;
        output.scrollTop = output.scrollHeight;
        
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }

    // Clear console
    function clearConsole() {
      document.getElementById('console-output').innerHTML = '<div class="timestamp">[Äá»£i requests...]</div>';
    }

    // Explain attack
    function explainAttack() {
      const div = document.getElementById('attack-explanation');
      div.style.display = div.style.display === 'none' ? 'block' : 'none';
    }

    // Copy curl command
    function copyCurlCommand() {
      const cmd = 'curl -I http://localhost:3000';
      navigator.clipboard.writeText(cmd).then(() => {
        alert('âœ… cURL command copied! Paste vÃ o terminal.');
      });
    }
  </script>
</body>
</html>
